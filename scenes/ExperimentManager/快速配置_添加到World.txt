# 在World.tscn中添加ExperimentManager

## 方法1：通过Godot编辑器（推荐）

1. 打开 World.tscn 场景
2. 在场景树的World根节点上右键
3. 选择"添加子节点"
4. 搜索并选择"Node"节点
5. 将节点命名为"ExperimentManager"
6. 在Inspector中：
   - 点击Script旁边的文件夹图标
   - 找到并选择 scenes/ExperimentManager/ExperimentManager.cs
   - 附加脚本

7. 配置属性：
   - Player Path: 设置为 "Player" 或 "../Player"
   - Experiments: 点击Array[ExperimentInfo]右侧的下拉箭头
     - 点击"添加元素"按钮3次，添加3个实验
     - 对于每个实验：
       - 点击"<空>"旁边的下拉菜单
       - 选择"新建ExperimentInfo"
       - 点击新创建的资源进行编辑
       
8. 配置第一个实验（摩擦力）：
   - Experiment Name: 摩擦力实验
   - Description: 探究滑动摩擦力的影响因素
   - Category: Mechanics (0)
   - Position: X=0.136, Y=0.5, Z=-4.557

9. 配置第二个实验（化学）：
   - Experiment Name: 铝与氢氧化钠反应
   - Description: 观察金属铝与碱溶液的反应
   - Category: Chemistry (2)
   - Position: 设置一个合适的位置，例如 X=-5, Y=0.5, Z=-4

10. 配置第三个实验（电学）：
    - Experiment Name: 欧姆定律实验
    - Description: 探究电流与电压、电阻的关系
    - Category: Electricity (1)
    - Position: 设置一个合适的位置，例如 X=5, Y=0.5, Z=-4

11. 保存场景 (Ctrl+S)

## 方法2：手动编辑World.tscn文件

在World.tscn文件的适当位置添加以下内容：

```
[node name="ExperimentManager" type="Node" parent="." node_paths=PackedStringArray("PlayerPath")]
script = ExtResource("path_to_ExperimentManager")
PlayerPath = NodePath("Player")
Experiments = Array[ExtResource("ExperimentInfo_resource")]([SubResource("ExperimentInfo_1"), SubResource("ExperimentInfo_2"), SubResource("ExperimentInfo_3")])

[sub_resource type="Resource" id="ExperimentInfo_1"]
script = ExtResource("path_to_ExperimentInfo")
ExperimentName = "摩擦力实验"
Description = "探究滑动摩擦力的影响因素"
Category = 0
Position = Vector3(0.136, 0.5, -4.557)

[sub_resource type="Resource" id="ExperimentInfo_2"]
script = ExtResource("path_to_ExperimentInfo")
ExperimentName = "铝与氢氧化钠反应"
Description = "观察金属铝与碱溶液的反应"
Category = 2
Position = Vector3(-5, 0.5, -4)

[sub_resource type="Resource" id="ExperimentInfo_3"]
script = ExtResource("path_to_ExperimentInfo")
ExperimentName = "欧姆定律实验"
Description = "探究电流与电压、电阻的关系"
Category = 1
Position = Vector3(5, 0.5, -4)
```

## 验证配置

配置完成后：
1. 运行游戏 (F5)
2. 按P键
3. 应该看到实验选择菜单

如果没有看到：
1. 检查Console输出是否有错误
2. 确认输入映射已添加（项目设置 -> 输入映射）
3. 确认ExperimentManager节点已添加到场景
4. 确认至少添加了一个实验信息

## 调试技巧

如果还是不显示，在ExperimentManager.cs的_Ready()方法中添加调试输出：
```csharp
public override void _Ready() {
    GD.Print("ExperimentManager _Ready 被调用");
    this.ProcessMode = ProcessModeEnum.Always;
    ResolvePlayer();
    GD.Print($"找到玩家: {player != null}");
    CreateExperimentMenu();
    GD.Print($"菜单创建: {experimentMenu != null}");
    CategorizeExperiments();
    UpdateMenuUI();
    GD.Print($"实验数量: {Experiments.Count}");
}
```

然后在_Input方法中添加：
```csharp
public override void _Input(InputEvent @event) {
    if (@event is InputEventKey keyEvent && keyEvent.Pressed && keyEvent.Keycode == Key.P) {
        GD.Print("P键被按下");
    }
    
    if (@event.IsActionPressed("toggle_experiment_menu")) {
        GD.Print("toggle_experiment_menu 动作触发");
        ToggleExperimentMenu();
        GetViewport().SetInputAsHandled();
    }
    // ...
}
```

这样可以帮助定位问题所在。

